<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Windows Control Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 14px;
        }
        
        .nav-tab.active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
            font-size: 14px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #51cf66, #40c057);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #ffd43b, #fab005);
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .input-group {
            margin: 10px 0;
        }
        
        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 5px;
        }
        
        .terminal {
            background: #1e1e1e;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 8px;
            height: 400px;
            overflow-y: auto;
            margin-bottom: 10px;
            white-space: pre-wrap;
        }
        
        .terminal-input {
            background: #1e1e1e;
            color: #00ff00;
            border: none;
            outline: none;
            font-family: 'Courier New', monospace;
            width: 100%;
            padding: 8px;
        }
        
        .process-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .process-table th, .process-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .process-table th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        
        .process-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .screenshot-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .screenshot-img {
            max-width: 100%;
            height: auto;
            border: 2px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .system-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .troll-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        #status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            display: none;
            z-index: 1000;
        }
        
        .success { background-color: #4CAF50; }
        .error { background-color: #f44336; }
        .warning { background-color: #ff9800; }
        
        .file-tree {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }
        
        .file-item {
            padding: 5px;
            cursor: pointer;
            border-radius: 3px;
        }
        
        .file-item:hover {
            background-color: #f0f0f0;
        }
        
        .folder-icon::before { content: "üìÅ "; }
        .file-icon::before { content: "üìÑ "; }
        
        .network-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .network-table th, .network-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 12px;
        }
        
        .audio-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .volume-slider {
            flex: 1;
            min-width: 200px;
        }
    </style>
</head>
<body>
    <div id="status"></div>
    
    <div class="container">
        <div class="header">
            <h1>Advanced Windows Control Panel</h1>
            <p>Professional remote system management interface</p>
        </div>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="switchTab('terminal')">Terminal</button>
            <button class="nav-tab" onclick="switchTab('processes')">Processes</button>
            <button class="nav-tab" onclick="switchTab('files')">Files</button>
            <button class="nav-tab" onclick="switchTab('network')">Network</button>
            <button class="nav-tab" onclick="switchTab('media')">Media</button>
            <button class="nav-tab" onclick="switchTab('system')">System</button>
            <button class="nav-tab" onclick="switchTab('fun')">Trolling</button>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="grid">
                <div class="card">
                    <h2>System Monitoring</h2>
                    <div class="system-info">
                        <div class="stat-card">
                            <h3>CPU Usage</h3>
                            <div id="cpuUsage">Loading...</div>
                            <div class="progress-bar">
                                <div id="cpuProgress" class="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <h3>Memory Usage</h3>
                            <div id="memoryUsage">Loading...</div>
                            <div class="progress-bar">
                                <div id="memoryProgress" class="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <h3>Disk Usage</h3>
                            <div id="diskUsage">Loading...</div>
                            <div class="progress-bar">
                                <div id="diskProgress" class="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="refreshSystemInfo()">Refresh</button>
                </div>
                
                <div class="card">
                    <h2>Screenshot</h2>
                    <div class="screenshot-container">
                        <img id="screenshotImg" class="screenshot-img" style="display: none;" alt="Screenshot">
                        <div id="screenshotPlaceholder">Click "Take Screenshot" to capture screen</div>
                    </div>
                    <button class="btn" onclick="takeScreenshot()">Take Screenshot</button>
                    <button class="btn" onclick="downloadScreenshot()">Download</button>
                </div>
                
                <div class="card">
                    <h2>Quick Controls</h2>
                    <button class="btn btn-danger" onclick="shutdownSystem()">Shutdown</button>
                    <button class="btn btn-danger" onclick="restartSystem()">Restart</button>
                    <button class="btn" onclick="lockSystem()">Lock Screen</button>
                    <button class="btn" onclick="openTaskManager()">Task Manager</button>
                    <button class="btn" onclick="openControlPanel()">Control Panel</button>
                    <button class="btn" onclick="openDeviceManager()">Device Manager</button>
                </div>
                
                <div class="card">
                    <h2>System Information</h2>
                    <div id="detailedSystemInfo">
                        <button class="btn" onclick="getDetailedSystemInfo()">Get System Details</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Terminal Tab -->
        <div id="terminal" class="tab-content">
            <div class="card">
                <h2>Terminal - cmd.exe</h2>
                <div id="terminalOutput" class="terminal">Microsoft Windows (Version {winver (eg. 10.0.19044.1706)} <!-- get the winver dynamically through python -->
(C) Microsoft Corporation. All rights reserved. <!-- get the current user dynamically through python -->
C:\Users\{CurrentUser}\> </div>
                <div style="display: flex;">
                    <span style="color: #00ff00; font-family: monospace; padding: 8px;">C:\\></span>
                    <input type="text" id="terminalInput" class="terminal-input" placeholder="Enter command..." onkeypress="handleTerminalInput(event)">
                </div>
                <div style="margin-top: 10px;">
                    <button class="btn" onclick="clearTerminal()">Clear</button>
                    <button class="btn" onclick="openPowerShell()">PowerShell</button>
                    <button class="btn" onclick="getCommandHistory()">Command History</button>
                </div>
            </div>
        </div>
        
        <!-- Processes Tab -->
        <div id="processes" class="tab-content">
            <div class="card">
                <h2>Task Manager</h2>
                <div style="margin-bottom: 15px;">
                    <button class="btn" onclick="refreshProcesses()">Refresh</button>
                    <button class="btn btn-success" onclick="toggleAutoRefresh()">Auto-Refresh (OFF)</button>
                    <input type="text" id="processFilter" placeholder="Filter processes..." style="margin-left: 10px; padding: 8px;">
                </div>
                <div style="overflow-x: auto;">
                    <table class="process-table" id="processTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>PID</th>
                                <th>CPU %</th>
                                <th>Memory %</th>
                                <th>Memory (MB)</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="processTableBody">
                            <tr><td colspan="7" style="text-align: center;">Click refresh to load processes</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Files Tab -->
        <div id="files" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2>File Explorer</h2>
                    <div class="input-group">
                        <label>Current Directory:</label>
                        <input type="text" id="currentPath" value="C:\\" readonly>
                    </div>
                    <div class="input-group">
                        <label>Navigate to:</label>
                        <input type="text" id="directoryPath" placeholder="C:\\Users\\YourName\\Desktop" value="C:\\">
                        <button class="btn" onclick="browseDirectory()">Browse</button>
                    </div>
                    <div id="fileTree" class="file-tree">
                        <div style="padding: 20px; text-align: center;">Enter a path and click Browse</div>
                    </div>
                </div>
                
                <div class="card">
                    <h2>File Stuff</h2>
                    <div class="input-group">
                        <label>Create Folder:</label>
                        <input type="text" id="newFolderName" placeholder="New Folder Name">
                        <button class="btn" onclick="createFolder()">Create</button>
                    </div>
                    <div class="input-group">
                        <label>Create File:</label>
                        <input type="text" id="newFileName" placeholder="filename.txt">
                        <button class="btn" onclick="createFile()">Create</button>
                    </div>
                    <div class="input-group">
                        <label>Run Program/Command:</label>
                        <input type="text" id="commandInput" placeholder="notepad.exe or full path">
                        <button class="btn" onclick="runCommand()">‚ñ∂Execute</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Network Tab -->
        <div id="network" class="tab-content">
            <div class="card">
                <h2>Network Information</h2>
                <button class="btn" onclick="refreshNetworkInfo()">Refresh Network Info</button>
                <button class="btn" onclick="getNetworkConnections()">Active Connections</button>
                <button class="btn" onclick="pingTest()">Ping Test</button>
                <div id="networkInfo">
                    <p>Click refresh to load network information</p>
                </div>
            </div>
        </div>
        
        <!-- Media Tab -->
        <div id="media" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2>Audio</h2>
                    <div class="audio-controls">
                        <button class="btn" onclick="muteSystem()">Mute</button>
                        <button class="btn" onclick="unmuteSystem()">Unmute</button>
                        <button class="btn" onclick="volumeUp()">+ Volume Up</button>
                        <button class="btn" onclick="volumeDown()">- Volume Down</button>
                    </div>
                    <div class="input-group">
                        <label>Set Volume (0-100):</label>
                        <input type="range" id="volumeSlider" min="0" max="100" value="50" class="volume-slider">
                        <button class="btn" onclick="setVolume()">Set Volume</button>
                    </div>
                </div>
                
                <div class="card">
                    <h2>Text-to-Speech</h2>
                    <div class="input-group">
                        <label>Text to speak:</label>
                        <textarea id="ttsText" placeholder="Enter text to make tts say..." rows="3"></textarea>
                        <button class="btn" onclick="speakText()">Play</button>
                        <button class="btn btn-danger" onclick="stopSpeaking()">Stop</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- System Tab -->
        <div id="system" class="tab-content">
            <div class="grid">
                <div class="card">
                    <h2>Display Control</h2>
                    <button class="btn" onclick="turnOffMonitor()">Turn Off Monitor</button>
                    <button class="btn" onclick="changeWallpaper()">Random Wallpaper</button>
                    <div class="input-group">
                        <label>Custom Wallpaper URL:</label>
                        <input type="text" id="wallpaperUrl" placeholder="https://example.com/image.jpg">
                        <button class="btn" onclick="setCustomWallpaper()">Set Wallpaper</button>
                    </div>
                </div>
                
                <div class="card">
                    <h2>System Services</h2>
                    <button class="btn" onclick="getServices()">List Services</button>
                    <button class="btn" onclick="getStartupPrograms()">Startup Programs</button>
                    <button class="btn" onclick="cleanTempFiles()">Clean Temp Files</button>
                    <div id="servicesInfo"></div>
                </div>
            </div>
        </div>
        
        <!-- Fun Tools Tab -->
        <div id="fun" class="tab-content">
            <div class="card">
                <h2>Trolling</h2>
                <div class="troll-grid">
                    <button class="btn btn-warning" onclick="openMultipleNotepad()">Spam Notepad windows</button>
                    <button class="btn btn-warning" onclick="flipScreen()">Flip Screen</button>
                    <button class="btn btn-warning" onclick="mouseJiggle()">Mouse Jiggler</button>
                    <button class="btn btn-warning" onclick="fakeBlueScreen()">BSOD</button>
                    <button class="btn btn-warning" onclick="openRandomWebsites()">Open Website</button>
                    <button class="btn btn-warning" onclick="typeRandomText()">Random Typing</button>
                    <button class="btn btn-warning" onclick="popupSpam()">Popup Spam</button>
                    <button class="btn btn-warning" onclick="desktopDance()">Desktop Dance</button>
                </div>
                
                <div class="input-group" style="margin-top: 20px;">
                    <label>Custom Message Box:</label>
                    <input type="text" id="customMessage" placeholder="Enter your message...">
                    <button class="btn" onclick="showCustomMessage()Show Message</button>
                </div>
                
                <div class="input-group">
                    <label>Schedule Task (x seconds from now):</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="number" id="scheduleSeconds" placeholder="30" style="width: 100px;">
                        <input type="text" id="scheduleCommand" placeholder="notepad.exe" style="flex: 1;">
                        <button class="btn" onclick="scheduleTask()">Schedule</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let autoRefreshInterval = null;
        let currentScreenshot = null;
        
        function switchTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from nav tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = type;
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        function refreshSystemInfo() {
            fetch('/api/system-info')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('cpuUsage').textContent = data.cpu + '%';
                    document.getElementById('cpuProgress').style.width = data.cpu + '%';
                    
                    document.getElementById('memoryUsage').textContent = data.memory + '%';
                    document.getElementById('memoryProgress').style.width = data.memory + '%';
                    
                    document.getElementById('diskUsage').textContent = data.disk + '%';
                    document.getElementById('diskProgress').style.width = data.disk + '%';
                })
                .catch(error => showStatus('Error updating system info', 'error'));
        }

        function takeScreenshot() {
            fetch('/api/screenshot')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const img = document.getElementById('screenshotImg');
                        const placeholder = document.getElementById('screenshotPlaceholder');
                        img.src = 'data:image/png;base64,' + data.image;
                        img.style.display = 'block';
                        placeholder.style.display = 'none';
                        currentScreenshot = data.image;
                        showStatus('Screenshot captured!');
                    } else {
                        showStatus(data.message, 'error');
                    }
                })
                .catch(error => showStatus('Error taking screenshot', 'error'));
        }

        function downloadScreenshot() {
            if (currentScreenshot) {
                const link = document.createElement('a');
                link.href = 'data:image/png;base64,' + currentScreenshot;
                link.download = 'screenshot_' + new Date().getTime() + '.png';
                link.click();
            } else {
                showStatus('No screenshot to download', 'warning');
            }
        }

        function handleTerminalInput(event) {
            if (event.key === 'Enter') {
                const input = document.getElementById('terminalInput');
                const command = input.value.trim();
                if (command) {
                    executeTerminalCommand(command);
                    input.value = '';
                }
            }
        }

        function executeTerminalCommand(command) {
            const output = document.getElementById('terminalOutput');
            output.textContent += 'C:\\> ' + command + '\\n';
            
            fetch('/api/terminal-command', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ command: command })
            })
            .then(response => response.json())
            .then(data => {
                output.textContent += data.output + '\\n\\nC:\\> ';
                output.scrollTop = output.scrollHeight;
            })
            .catch(error => {
                output.textContent += 'Error executing command\\n\\nC:\\> ';
                output.scrollTop = output.scrollHeight;
            });
        }

        function clearTerminal() {
            document.getElementById('terminalOutput').textContent = 'C:\Users\{CurrentUser}\> '; // get the current user dynamically again.
        }

        function refreshProcesses() {
            fetch('/api/processes-detailed')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.getElementById('processTableBody');
                    tbody.innerHTML = '';
                    
                    data.processes.forEach(proc => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${proc.name}</td>
                            <td>${proc.pid}</td>
                            <td>${proc.cpu}%</td>
                            <td>${proc.memory}%</td>
                            <td>${proc.memory_mb} MB</td>
                            <td><span style="color: ${proc.status === 'running' ? 'green' : 'orange'}">${proc.status}</span></td>
                            <td>
                                <button class="btn btn-small btn-danger" onclick="killProcess(${proc.pid})">‚ùå</button>
                                <button class="btn btn-small" onclick="getProcessInfo(${proc.pid})">‚ÑπÔ∏è</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                    
                    showStatus('Processes refreshed');
                })
                .catch(error => showStatus('Error loading processes', 'error'));
        }

        function toggleAutoRefresh() {
            const btn = event.target;
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                btn.textContent = 'Auto-Refresh (OFF)';
                btn.classList.add('btn btn-success');
            } else {
                autoRefreshInterval = setInterval(refreshProcesses, 2000);
                btn.textContent = 'Auto-Refresh (ON)';
                btn.classList.add('btn btn-success');
            }
        }

        function killProcess(pid) {
            if (confirm(`Kill process ${pid}?`)) {
                fetch('/api/kill-process', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ pid: pid })
                })
                .then(response => response.json())
                .then(data => {
                    showStatus(data.message, data.success ? 'success' : 'error');
                    if (data.success) refreshProcesses();
                });
            }
        }

        // System Control Functions
        function shutdownSystem() {
            if (confirm('Shutdown computer?')) {
                fetch('/api/shutdown', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
            }
        }

        function restartSystem() {
            if (confirm('Restart computer?')) {
                fetch('/api/restart', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
            }
        }

        function lockSystem() {
            fetch('/api/lock', { method: 'POST' })
                .then(response => response.json())
                .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function openTaskManager() {
            fetch('/api/open-app', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ app: 'taskmgr' })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function openControlPanel() {
            fetch('/api/open-app', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ app: 'control' })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function openDeviceManager() {
            fetch('/api/open-app', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ app: 'devmgmt.msc' })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function openPowerShell() {
            fetch('/api/open-app', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ app: 'powershell' })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function getDetailedSystemInfo() {
            fetch('/api/detailed-system-info')
                .then(response => response.json())
                .then(data => {
                    const infoDiv = document.getElementById('detailedSystemInfo');
                    infoDiv.innerHTML = `
                        <h3>System Details</h3>
                        <p><strong>Computer Name:</strong> ${data.computer_name}</p>
                        <p><strong>Username:</strong> ${data.username}</p>
                        <p><strong>OS:</strong> ${data.os}</p>
                        <p><strong>Processor:</strong> ${data.processor}</p>
                        <p><strong>Architecture:</strong> ${data.architecture}</p>
                        <p><strong>Total RAM:</strong> ${data.total_memory} GB</p>
                        <p><strong>Python Version:</strong> ${data.python_version}</p>
                        <p><strong>Uptime:</strong> ${data.uptime}</p>
                        <button class="btn" onclick="getDetailedSystemInfo()">üîÑ Refresh</button>
                    `;
                })
                .catch(error => showStatus('Error getting system info', 'error'));
        }

        function getCommandHistory() {
            fetch('/api/command-history')
                .then(response => response.json())
                .then(data => {
                    const output = document.getElementById('terminalOutput');
                    output.textContent += '\\n=== Command History ===\\n';
                    data.history.forEach((cmd, index) => {
                        output.textContent += `${index + 1}. ${cmd}\\n`;
                    });
                    output.textContent += '=====================\\n\\nC:\\> ';
                    output.scrollTop = output.scrollHeight;
                })
                .catch(error => showStatus('Error getting history', 'error'));
        }

        function browseDirectory() {
            const path = document.getElementById('directoryPath').value;
            fetch('/api/browse-directory', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ path: path })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('currentPath').value = data.current_path;
                    const tree = document.getElementById('fileTree');
                    tree.innerHTML = '';
                    
                    data.items.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'file-item';
                        div.innerHTML = `<span class="${item.type}-icon"></span>${item.name}`;
                        if (item.type === 'folder') {
                            div.onclick = () => {
                                document.getElementById('directoryPath').value = item.path;
                                browseDirectory();
                            };
                        }
                        tree.appendChild(div);
                    });
                    showStatus('Directory loaded');
                } else {
                    showStatus(data.message, 'error');
                }
            })
            .catch(error => showStatus('Error browsing directory', 'error'));
        }

        function createFolder() {
            const name = document.getElementById('newFolderName').value;
            const currentPath = document.getElementById('currentPath').value;
            
            if (!name) {
                showStatus('Please enter folder name', 'warning');
                return;
            }
            
            fetch('/api/create-folder', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ path: currentPath, name: name })
            })
            .then(response => response.json())
            .then(data => {
                showStatus(data.message, data.success ? 'success' : 'error');
                if (data.success) {
                    document.getElementById('newFolderName').value = '';
                    browseDirectory();
                }
            });
        }

        function createFile() {
            const name = document.getElementById('newFileName').value;
            const currentPath = document.getElementById('currentPath').value;
            
            if (!name) {
                showStatus('Please enter file name', 'warning');
                return;
            }
            
            fetch('/api/create-file', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ path: currentPath, name: name })
            })
            .then(response => response.json())
            .then(data => {
                showStatus(data.message, data.success ? 'success' : 'error');
                if (data.success) {
                    document.getElementById('newFileName').value = '';
                    browseDirectory();
                }
            });
        }

        function runCommand() {
            const command = document.getElementById('commandInput').value;
            
            if (!command) {
                showStatus('Please enter command', 'warning');
                return;
            }
            
            fetch('/api/run-command', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ command: command })
            })
            .then(response => response.json())
            .then(data => {
                showStatus(data.message, data.success ? 'success' : 'error');
                document.getElementById('commandInput').value = '';
            });
        }

        function refreshNetworkInfo() {
            fetch('/api/network-info')
                .then(response => response.json())
                .then(data => {
                    const infoDiv = document.getElementById('networkInfo');
                    let html = '<h3>Network Interfaces</h3>';
                    
                    data.interfaces.forEach(iface => {
                        html += `
                            <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                <strong>${iface.name}</strong><br>
                                IP: ${iface.ip}<br>
                                Status: <span style="color: ${iface.status === 'up' ? 'green' : 'red'}">${iface.status}</span>
                            </div>
                        `;
                    });
                    
                    infoDiv.innerHTML = html;
                })
                .catch(error => showStatus('Error getting network info', 'error'));
        }

        function getNetworkConnections() {
            fetch('/api/network-connections')
                .then(response => response.json())
                .then(data => {
                    const infoDiv = document.getElementById('networkInfo');
                    let html = '<h3>Active Network Connections</h3>';
                    html += '<table class="network-table"><tr><th>Local Address</th><th>Remote Address</th><th>Status</th><th>PID</th></tr>';
                    
                    data.connections.forEach(conn => {
                        html += `<tr>
                            <td>${conn.local_address}</td>
                            <td>${conn.remote_address}</td>
                            <td>${conn.status}</td>
                            <td>${conn.pid}</td>
                        </tr>`;
                    });
                    
                    html += '</table>';
                    infoDiv.innerHTML = html;
                })
                .catch(error => showStatus('Error getting connections', 'error'));
        }

        function pingTest() {
            const target = prompt('Enter IP or hostname to ping:', 'google.com');
            if (target) {
                fetch('/api/ping', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ target: target })
                })
                .then(response => response.json())
                .then(data => {
                    const infoDiv = document.getElementById('networkInfo');
                    infoDiv.innerHTML = `<h3>Ping Results</h3><pre>${data.result}</pre>`;
                });
            }
        }

        // Audio Controls
        function muteSystem() {
            fetch('/api/audio-control', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'mute' })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function unmuteSystem() {
            fetch('/api/audio-control', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'unmute' })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function volumeUp() {
            fetch('/api/audio-control', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'volume_up' })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function volumeDown() {
            fetch('/api/audio-control', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'volume_down' })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function setVolume() {
            const volume = document.getElementById('volumeSlider').value;
            fetch('/api/audio-control', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'set_volume', volume: parseInt(volume) })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function speakText() {
            const text = document.getElementById('ttsText').value;
            if (!text) {
                showStatus('Please enter text to speak', 'warning');
                return;
            }
            
            fetch('/api/tts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: text })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function stopSpeaking() {
            fetch('/api/tts-stop', { method: 'POST' })
                .then(response => response.json())
                .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function turnOffMonitor() {
            fetch('/api/monitor-control', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'off' })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function changeWallpaper() {
            fetch('/api/wallpaper', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'random' })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function setCustomWallpaper() {
            const url = document.getElementById('wallpaperUrl').value;
            if (!url) {
                showStatus('Please enter wallpaper URL', 'warning');
                return;
            }
            
            fetch('/api/wallpaper', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'custom', url: url })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function getServices() {
            fetch('/api/services')
                .then(response => response.json())
                .then(data => {
                    const infoDiv = document.getElementById('servicesInfo');
                    let html = '<h3>System Services</h3>';
                    html += '<div style="max-height: 300px; overflow-y: auto;">';
                    
                    data.services.forEach(service => {
                        html += `
                            <div style="margin: 5px 0; padding: 8px; border: 1px solid #ddd; border-radius: 3px;">
                                <strong>${service.name}</strong> - 
                                <span style="color: ${service.status === 'running' ? 'green' : 'orange'}">${service.status}</span>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    infoDiv.innerHTML = html;
                })
                .catch(error => showStatus('Error getting services', 'error'));
        }

        function getStartupPrograms() {
            fetch('/api/startup-programs')
                .then(response => response.json())
                .then(data => {
                    const infoDiv = document.getElementById('servicesInfo');
                    let html = '<h3>Startup Programs</h3>';
                    html += '<div style="max-height: 300px; overflow-y: auto;">';
                    
                    data.programs.forEach(program => {
                        html += `
                            <div style="margin: 5px 0; padding: 8px; border: 1px solid #ddd; border-radius: 3px;">
                                <strong>${program.name}</strong><br>
                                <small>${program.command}</small>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    infoDiv.innerHTML = html;
                })
                .catch(error => showStatus('Error getting startup programs', 'error'));
        }

        function cleanTempFiles() {
            if (confirm('Clean temporary files? This may take a few moments.')) {
                fetch('/api/clean-temp', { method: 'POST' })
                    .then(response => response.json())
                    .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
            }
        }

        // Fun/Troll Functions
        function openMultipleNotepad() {
            const count = prompt('How many Notepad instances?', '10');
            if (count && parseInt(count) > 0) {
                fetch('/api/fun-tools', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'spam_notepad', count: parseInt(count) })
                })
                .then(response => response.json())
                .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
            }
        }

        function flipScreen() {
            fetch('/api/fun-tools', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'flip_screen' })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function mouseJiggle() {
            const duration = prompt('Duration in seconds?', '30');
            if (duration && parseInt(duration) > 0) {
                fetch('/api/fun-tools', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'mouse_jiggle', duration: parseInt(duration) })
                })
                .then(response => response.json())
                .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
            }
        }

        function fakeBlueScreen() {
            if (confirm('Show blue screen?')) {
                fetch('/api/fun-tools', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'bsod' })
                })
                .then(response => response.json())
                .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
            }
        }

        function matrixRain() {
            fetch('/api/fun-tools', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'matrix_rain' })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function openRandomWebsites() {
            const count = prompt('How many random websites?', '5');
            if (count && parseInt(count) > 0) {
                fetch('/api/fun-tools', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'random_websites', count: parseInt(count) })
                })
                .then(response => response.json())
                .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
            }
        }

        function typeRandomText() {
            const duration = prompt('Duration in seconds?', '10');
            if (duration && parseInt(duration) > 0) {
                fetch('/api/fun-tools', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'random_typing', duration: parseInt(duration) })
                })
                .then(response => response.json())
                .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
            }
        }

        function popupSpam() {
            const count = prompt('How many popups?', '10');
            if (count && parseInt(count) > 0) {
                fetch('/api/fun-tools', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'popup_spam', count: parseInt(count) })
                })
                .then(response => response.json())
                .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
            }
        }

        function cdTrayTroll() {
            const count = prompt('How many times to open/close CD tray?', '5');
            if (count && parseInt(count) > 0) {
                fetch('/api/fun-tools', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'cd_tray', count: parseInt(count) })
                })
                .then(response => response.json())
                .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
            }
        }

        function desktopDance() {
            fetch('/api/fun-tools', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'desktop_dance' })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function showCustomMessage() {
            const message = document.getElementById('customMessage').value;
            if (!message) {
                showStatus('Please enter a message', 'warning');
                return;
            }
            
            fetch('/api/show-message', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: message })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function scheduleTask() {
            const seconds = document.getElementById('scheduleSeconds').value/60; // not sure if this will make it so that the inputted number is in seconds and not minutes, but i think i did it.
            const command = document.getElementById('scheduleCommand').value;
            
            if (!seconds || !command) {
                showStatus('Please enter both seconds and command', 'warning');
                return;
            }
            
            fetch('/api/schedule-task', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    seconds: parseInt(seconds), 
                    command: command 
                })
            })
            .then(response => response.json())
            .then(data => showStatus(data.message, data.success ? 'success' : 'error'));
        }

        function getProcessInfo(pid) {
            fetch(`/api/process-info/${pid}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const info = data.info;
                        alert(`Process Info:
Name: ${info.name}
PID: ${info.pid}
Status: ${info.status}
CPU: ${info.cpu}%
Memory: ${info.memory} MB
Command: ${info.cmdline}
Created: ${info.create_time}`);
                    } else {
                        showStatus(data.message, 'error');
                    }
                })
                .catch(error => showStatus('Error getting process info', 'error'));
        }

        // Auto-refresh system info on page load
        document.addEventListener('DOMContentLoaded', function() {
            refreshSystemInfo();
            
            // Set up process filter
            document.getElementById('processFilter').addEventListener('input', function(e) {
                const filter = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('#processTableBody tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(filter) ? '' : 'none';
                });
            });
        });

        // Update volume slider display
        document.getElementById('volumeSlider').addEventListener('input', function(e) {
            const volumeDisplay = document.createElement('span');
            volumeDisplay.textContent = e.target.value + '%';
            volumeDisplay.style.marginLeft = '10px';
            
            // Remove existing display
            const existing = e.target.parentNode.querySelector('span');
            if (existing) existing.remove();
            
            e.target.parentNode.appendChild(volumeDisplay);
        });
    </script>
</body>
</html>